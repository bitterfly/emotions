% !TEX program = xelatex
\documentclass[12pt]{report}
\usepackage{unicode-math}
\usepackage{amsmath}
\usepackage{xltxtra}

\defaultfontfeatures{Ligatures=TeX}
\setmainfont{Comfortaa-Regular}
\setmathfont{Neo Euler}

\usepackage[english, bulgarian]{babel}
\usepackage{indentfirst}
\usepackage[a4paper, portrait, margin = 2.0 cm]{geometry}
\usepackage{url}
\usepackage{color}
\usepackage{float}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{subfig}
\usepackage[export]{adjustbox}
\usepackage{blindtext}
\usepackage{scrextend}
\usepackage{amsfonts}


\numberwithin{equation}{section}
\numberwithin{figure}{section}
\addtokomafont{labelinglabel}{\sffamily}

\def\changemargin#1#2{\list{}{\rightmargin#2\leftmargin#1}\item[]}
\let\endchangemargin=\endlist 

\renewcommand{\baselinestretch}{1.1}
\setlength{\emergencystretch}{3em}

\usepackage{graphicx}
\graphicspath{ {./resources/} }

\DeclareFontFamily{OT1}{pzc}{}

\DeclareFontShape{OT1}{pzc}{m}{it}{<-> s * [1.5] pzcmi7t}{}
\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it}

\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

\lstset{
	backgroundcolor = \color{light-gray},
    language = C,
    xleftmargin = 1cm,
    framexleftmargin = 1em,
    basicstyle=\ttfamily,
	moredelim=[is][\underbar]{_}{_},
}

\usepackage{color}
\definecolor{Bluish}{rgb}{0.39,0.55,0.78}
\definecolor{light-gray}{gray}{0.9}

\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linktoc=all,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}

\usepackage{tabularx}


\title{Дипломна работа}
\author{Диана Генева <dageneva@qtrp.org>}
\date{2018}

\begin{document}
\maketitle
\thispagestyle{empty}
\tableofcontents
\pagebreak

\chapter{Нулева зона}
Бла, бла, бла, аз съм толкова емоционална. 
Не знам

\includegraphics[width=0.5\textwidth ]{pikachu}

\chapter{Емоции в реч}
    \section{Физика на тъгата}
    Вокален тракт е общото название на кухините над ларингса (гръкляна), през които минава въздуха при генериране на реч.
    При хората той се състои от ларингеална кухина, фарингс, устна кухина и носна кухина, които могат да се видят на Фиг. 1.
    Вокалният тракт е отговорен за произвеждане на различни звуци, като текущата конфигурация на отделните му компоненти определя самия звук.
    Според [https://ieeexplore.ieee.org/document/4809202], освен конкретния звук, конфигурацията на вокалния тракт зависи и от емоцията, която изпитва говорещият. 
    Из българската литература се срещат изречения като "страхът стискаше гърлото, задушаваше гласа"[Гласовете ви чувам] и изрази като "буца в гърлото" или "пресъхнало гърло" са станали синоними за дадено емоционално
    състояние в разговорната реч. Тези фрази имат физиологично обяснение и влияят върху характеристиките на произведената реч.
    Именно затова бихме искали да можем математически да моделираме конфигурацията на вокалния тракт и да извличаме характеристики от нея.
    \begin{figure}[ht]%
        \centering
        \begin{changemargin}{0cm}{0cm} 
            \subfloat[Part 1]{%
                \includegraphics[width=0.48\paperwidth,valign=t]{physics}%
            } \hspace{0.8cm}
            \subfloat[Part 2]{%
                \includegraphics[width=0.28\paperwidth,valign=t]{tubes}%
                \vphantom{\includegraphics[width=0.48\paperwidth,valign=t]{physics}}%
            }
        \end{changemargin} 

        \caption{Гррррр}%
        \label{fig:example}%
    \end{figure}
    
    Да разгледаме по-подробно Фиг.1 и цялостна система за производство на реч.
    Речта, всъщност, представлява просто акустичната вълна, получена на края на системата - устни и ноздри - в следствие на изкарания от белия дроб въздух.

    Белият дроб работи като енергиен източник за тази системата - въздушният поток, получен при свиването му от междуребрените мускули и диафрагмата,
    се пропагира нагоре по трахеята и през глотиса (отворе между гласните струни). Тъй като налягането в глотиса е по-малко от това в който и да е от двата му края, по закона на Бернули
    в някакъв момент става толкова ниско, че позволява на гласните струни да се затворят. В следствие се натрупва налягане зад гласните струни, което в някакъв момент ги принуждава
    да се отворят и цикълът се повтаря отначало. В резултат се получава осцилиране на гласните струни. Честотата на отварянето и затварянето зависи от анатомични особености като еластичността и големината на
    гласните струни, налягането в белия дроб и други. При мъжете тази честота е средно 125 Hz, а при жените - 210 Hz. Акустичната вълна, която се получава в следствие на осцилацията,
    преминава през вокалния тракт, където се завихря, при срещане на прегради, като устни и зъби, и в крайна сметка напуска системата през някой от отворите.

    При целият този процес се губи част от енергията, поради различни фактори: стените на вокалния тракт са меки и еластични, радиацията на вълната при устните и ноздрите и други.

    В зависимост от начинът, по който вълната напуска системата, можем да класифицираме произведените звуци по следния начин:

    \begin{enumerate}
        \item Озвучени 
        При тези звуци гласните струни осцилират квази-периодично.
        \item Проходни (фрикативни) 
        При образуването на проходни звуци, вълната среща преграда по пътя си
            (като например зъби, устни), и се получава турболенция при опита въздухът да бъде избутан през преградата
        \item Преградни (експлозивни)
        Те се получават, когато преградата е пълна, което позволява да се натрупа налягане
        зад съответната прегада, което се освобождава рязко.
    \end{enumerate}
    
    Ако разгледаме вокалния тракт и носната кухина като свързани тръби с непостоянно напречно сечение и вземем предвид горното описание за генериране на звук,
    то честотният спектър ще зависи от честнотната пропускливост на тръбите (frequency selectivity) Трябва да видя онова в тетрадката. Това много прилича на свирене на духов инструмент.
    Честотите на които се получава резонанс зависи от формата и размера на тръбите. Известно е, че за да се образува определен звук, трябва да се промени формата на вокалния тракт по 
    съответния начин. (Например, когато човек казва "н" езикът се залепя зад зъбите и т.н.). В такъв случай, спектралните особености на сигнала се менят с времето, тъй като се мени и
    положението на вокалния тракт. Смята се [], че състоянието на вокалния тракт е сравнително статично (достатъчно статично за нашите цели) в рамките на 15ms, преди да се смени съответната
    фонема, която се изговаря. В такъв случай, можем да излседваме спектралните свойства в този отрязък от време и да извличаме информацията за подлежата емоция в него. 

    \section{Загладено опростяване}
    За улеснение, нека разгледаме конкретна конфигурация. Например тази, при произнасянето на фонемата ``ъ'', тъй като е възможно най-проста.
    
    В случая на гласната ``ъ'' , глотиса трепти, а клапата към носната кухина е затворена и само устната кухина участва в образуването на звука. 
    Т.е. имаме някакъв източник на псевдо-периодично трептене $\mathpzc{U}$ - глотис, после вълната преминава и се променя от вокалния тракт $\mathpzc{V}$ и накрая излиза и се пречупва през
    устните $\mathpzc{R}$. Сигналът, който получаваме накрая е $\mathpzc{Y}(z) = \mathpzc{U}(z)\mathpzc{V}(z)\mathpzc{R}(z)$
    и това, от което се интересуваме е $\mathpzc{V}$.
    \begin{figure}[ht]%
        \includegraphics[width=\textwidth]{vocal_tubes}%
        \caption{Приближение на вокалния тракт с $k$ тръби}%
    \end{figure}
    Нека устната кухина е приближена с $k$ на брой тръби с постоянно напречно сечение, както е показано на Фиг.2.
    За още по-голямо опростяване нека няма и загуба на енергия, каквата би се получила попринцип.

    Нека въведем следните стандартни означения:
    \begin{enumerate}
        \item{$\mathcal{c}$} - скорост на звука , т.е. това е разстоянието, което пропътува вълната за единица време
        \item{$\rho$} - плътност на въздуха
        \item{$\mathcal{A}$} - напречно сечение
        \item{$u$} - обемна скорост
        \item{$p$} -  налягане - можем да си мислим за него като ``колко сила е нужна, за да се преместят частитицит''
    \end{enumerate}
    
    Тъй като въздухът е течна среда, как пътува вълна през него се определя от свойствата на въздуха и от ограниченията на тръбата като дължина и ширина. Звуковите вълни, преминаващи през
    тръба изпълняват уравнения [Rabiner and Schafer, pg 59, (3.2a) (3.2b)]:
    
    \begin{subequations}
        \begin{align}\label{eq:2:1:01}
            \frac{\partial\rho}{\partial x} & = \frac{\rho}{\mathcal{A}} \frac{\partial u}{\partial t}\\
            \frac{\partial u}{\partial x} & = \frac{\mathcal{A}}{\rho \mathcal{c}^2} \frac{\partial \rho}{\partial t}
        \end{align}
    \end{subequations}

    При преминава от една тръба в друга, част от вълните ще преминат към следващата тръба, а част от тях ще се отразят в наобратно.
    В такъв случай във всеки момент от време $t$ и във всяка точка $x$ на всяка тръба,
    обемната скорост $u$ ще зависи от обемната скорост на вълните,
    които вървят ``напред'' и тази на вълните, които вървят ``назад''.
    Затова може да се покаже, че уравненията $\ref{eq:2:1:01}$ имат решение във следния вид:

    \begin{subequations}
        \begin{align}\label{eq:2:1:02}
            u_{k}(x, t) & = [u_{k}^{+}(t - \frac{x}{\mathcal{c}}) - u_{k}^{-}(t + \frac{x}{\mathcal{c}})]\\
            p_{k}(x, t) & = \frac{\rho \mathcal{c}}{\mathcal{A}_{k}} [u_{k}^{+}(t - \frac{x}{\mathcal{c}}) + u_{k}^{-}(t + \frac{x}{\mathcal{c}})]
        \end{align}
    \end{subequations}

    където 
    \begin{enumerate}
        \item{$t_{k}$} е $k$-тата тръба, която има дължина $l_k$ и лице на напречното сечение $A_k$
        \item{$x$} е разстояние в $t_k$ ($0\leq x \leq l_k$)
        \item{$t$} е момент от време
        \item{$u^{+}$ и $u^{-}$} са съответно вълните, които вървят "напред" и тези, които вървят "назад"
    \end{enumerate}

    Освен това, при преминаването от една тръба в друга са изпълнени следните равенства:
    \begin{subequations}
        \begin{align}\label{eq:2:1:03}
            u_k(l_k, t) & = u_{k+1}(0, t)\\
            p_k(l_k, t) & = p_{k+1}(0, t)
        \end{align}
    \end{subequations}

    Когато заместим уравнения $\ref{eq:2:1:03}$ в $\ref{eq:2:1:02}$, получаваме:
    \begin{align*}
        & u_k^+(t - \frac{l_k}{\mathcal{c}}) - u_k^{-}(t + \frac{l_k}{\mathcal{c}}) = u_{k+1}^{+}(t) - u_{k+1}^{-}(t)\\
        & \intertext{и}\\
        & \frac{\rho \mathcal{c}}{\mathcal{A}_{k}} [u_{k}^{+}(t - \frac{l_k}{\mathcal{c}}) + u_{k}^{-}(t + \frac{x}{\mathcal{c}})] = \frac{\rho \mathcal{c}}{\mathcal{A}_{k+1}} [u_{k+1}^{+}(t) + u_{k+1}^{-}(t)]\\
        & \iff\\
        & \frac{A_{k+1}}{A_{k}}[u_{k}^{+}(t - \frac{l_k}{\mathcal{c}}) + u_{k}^{-}(t + \frac{x}{\mathcal{c}})] = u_{k+1}^{+}(t) + u_{k+1}^{-}(t)
    \end{align*}


    Нека означим с $\tau_{k}$ времето, за което вълна пропътува дължината на $k$-тата тръба, тоест $\tau_{k}= \frac{l_k}{\mathcal{c}}$. Тогава имаме:

    \begin{align}
        \label{eq:2:1:04}
        & u_k^+(t - \tau_k) - u_k^{-}(t + \tau_k) = u_{k+1}^{+}(t) - u_{k+1}^{-}(t)\\
        \label{eq:2:1:05}
        & \frac{A_{k+1}}{A_{k}}[u_{k}^{+}(t - \tau_k) + u_{k}^{-}(t + \tau_k)] = u_{k+1}^{+}(t) + u_{k+1}^{-}(t)
    \end{align}
    Първо, нека да изразим скоростта на вълните, които вървят "напред"
    в $(k+1)$-та тръба ($u_{k+1}^{+}$), чрез тези, които са преминали от предната тръба ($u_k^{+}$)
    и тези, които се отразяват от текущата ($u_{k+1}^{-}$).
    \begin{align}
        & \nonumber \intertext{От $\ref{eq:2:1:04}$ получаваме}
        & \label{eq:2:1:06} u_{k}^{-}(t + \tau_{k}) = u_{k}^{+}(t - \tau_k) - u_{k+1}^{+}(t)  + u_{k+1}^{-}(t)\\
        & \nonumber \intertext{Заместваме $\ref{eq:2:1:06}$ в $\ref{eq:2:1:05}$}
        & \nonumber u_{k+1}^{+}(t) = \frac{A_{k+1}}{A_k} u_{k}^{+}(t - \tau_k) + \frac{A_{k+1}}{A_k}[u_{k}^{+}(t - \tau_k) - u_{k+1}^{+}(t)  + u_{k+1}^{-}(t)] - u_{k+1}^{-}(t) \\
        & \nonumber u_{k+1}^{+}(t)[1 + \frac{A_{k+1}}{A_k}] = u_{k}^{+}(t - \tau_k)\frac{2A_{k+1}}{A_k} + u_{k+1}^{-}(t)[\frac{A_{k+1}}{A_k} - 1] \\
        & \nonumber u_{k+1}^{+}(t)[\frac{A_k + A_{k+1}}{A_k}] = u_{k}^{+}(t - \tau_k)\frac{2A_{k+1}}{A_k} + u_{k+1}^{-}(t)[\frac{A_{k+1} - A_k}{A_k}]\\
        & \label{eq:2:1:07} u_{k+1}^{+}(t) = u_{k}^{+}(t - \tau_k)[\frac{2A_{k+1}}{A_k + A_{k+1}}] + u_{k+1}^{-}(t)[\frac{A_{k+1} - A_k}{A_k + A_{k+1}}]
    \end{align}
        

    Коефициентът, който стои пред $u_k^{+}(t - \tau_k)$ в уравнение $\ref{eq:2:1:07}$,
    представлява количеството енергия, която преминава от тръба $k$ в тръба $k+1$,
    идваща от вълните, които се движат "напред" в $k$-тата тръба. Затова
    \begin{equation}
        \label{eq:2:1:08}
        t_k = \frac{2A_{k+1}}{A_k + A_{k+1}}
    \end{equation}
    се нарича \textbf{коефициент на преминаване} за $k$-тия преход (преходът между тръби $k$ и $k+1$).
    Коефициентът пред $u_{k+1}^{-}(t)$ представлява количестото енергия, получена от вълните,
    които вървят "назад" в тръба $k+1$. Затова 
    \begin{equation}
        \label{eq:2:1:09}
        r_k = \frac{A_{k+1} - A_k}{A_k + A_{k+1}}
    \end{equation}
    се нарича \textbf{коефициент на отрязяване} за $k$-тия преход. 
    
    Можем да забележим, че в специалния случай, в който напречните сечения на
    две съседни тръби са равни ($A_k = A_{k+1}$), би следвало всички
    вълни да преминават свободно. Наистина, ако заместим в уравнение $\ref{eq:2:1:09}$,
    $r_k = 0$, a от $\ref{eq:2:1:08}$ се вижда, че $t_k = 1$

    Нека изразим скоростта на вълните в тръба $k$ чрез скоростта на вълните в $(k+1)$-вата тръба. 
    

    \begin{subequations}
        \label{eq:2:1:10}
        \begin{align}
            & \nonumber \intertext{Първо разместваме уравнение $\ref{eq:2:1:07}$}
            & \label{eq:2:1:10:a} u_k^{+}(t - \tau_k) = u_{k+1}^{+}(t)[\frac{A_k + A_{k+1}}{2A_{k+1}}] + u_{k+1}^{-}(t)[\frac{A_k - A_{k+1}}{2A_{k+1}}]\\
            & \nonumber \intertext{Заместваме $\ref{eq:2:1:10:a}$ в $\ref{eq:2:1:04}$}
            & \nonumber u_k^{-}(t + \tau_k) = u_k^{+}(t - \tau_k) - u_{k+1}^{+}(t) + u_{k+1}^{-}(t)\\
            & \nonumber u_k^{-}(t + \tau_k) = u_{k+1}^{+}(t)[\frac{A_k + A_{k+1}}{2A_{k+1}}] + u_{k+1}^{-}(t)[\frac{A_k - A_{k+1}}{2A_{k+1}}] - u_{k+1}^{+}(t) + u_{k+1}^{-}(t)\\
            & \nonumber u_k^{-}(t + \tau_k) = u_{k+1}^{+}(t)[\frac{A_k + A_{k+1} - 2A_{k+1}}{2A_{k+1}}] + u_{k+1}^{-}(t)[\frac{A_k - A_{k+1} + 2A_{k+1}}{2A_{k+1}}]\\
            & \label{eq:2:1:10:b} u_k^{-}(t + \tau_k) = u_{k+1}^{+}(t)[\frac{A_k - A_{k+1}}{2A_{k+1}}] + u_{k+1}^{-}(t)[\frac{A_k + A_{k+1}}{2A_{k+1}}]
        \end{align}
    \end{subequations}

    Използвайки, че
    \begin{align*}
        \frac{1}{1 + r_k} & = \frac{A_k + A_{k+1}}{A_{k+1} - A_k + A_{k+1} + A_k} = \frac{A_k + A_{k+1}}{2A_{k+1}}\\
        \\
        \frac{r_k}{1 + r_k} & = \frac{(A_{k+1} - A_k)}{(A_k + A_{k+1})} \frac{(A_k + A_{k+1})}{2A_{k+1}} = \frac{A_{k+1} - A_k}{2A_{k+1}}
    \end{align*}
    можем да запишем уравненията $\ref{eq:2:1:10}$ във вида:

    \begin{subequations}
        \label{eq:2:1:11}
        \begin{align}
           & u_k^{+}(t - \tau_k) = \frac{1}{1 + r_k} u_{k+1}^{+}(t) - \frac{r_k}{1+r_k} u_{k+1}^{-}(t)\\
           & u_k^{-}(t + \tau_k) = - \frac{r_k}{1+r_k} u_{k+1}^{-}(t) + u_{k+1}^{+}(t) + \frac{1}{1 + r_k} u_{k+1}^{-}(t)
        \end{align}
    \end{subequations}

    Сега да разгледаме уравнения $\ref{eq:2:1:11}$ в $\mathcal{z}$-домейна:
    \begin{subequations}
        \label{eq:2:1:12}
        \begin{align}
           & \nonumber \mathcal{z}^{-\tau_k}U_k^{+}(\mathcal{z}) = \frac{1}{1 + r_k} U_{k+1}^{+}(\mathcal{z}) - \frac{r_k}{1+r_k} U_{k+1}^{-}(\mathcal{z})\\
           & \nonumber \mathcal{z}^{\tau_k} U_k^{-}(\mathcal{z}) = - \frac{r_k}{1+r_k} U_{k+1}^{-}(\mathcal{z}) + U_{k+1}^{+}(\mathcal{z}) + \frac{1}{1 + r_k} U_{k+1}^{-}(\mathcal{z})\\
           & \nonumber \iff\\
           & U_k^{+}(\mathcal{z}) = \frac{\mathcal{z}^{\tau_k}}{1 + r_k} U_{k+1}^{+}(\mathcal{z}) - \frac{r_k\mathcal{z}^{\tau_k}}{1+r_k} U_{k+1}^{-}(\mathcal{z})\\
           & U_k^{-}(\mathcal{z}) = - \frac{r_k\mathcal{z}^{-\tau_k} }{1+r_k} U_{k+1}^{-}(\mathcal{z}) + U_{k+1}^{+}(\mathcal{z}) + \frac{\mathcal{z}^{-\tau_k} }{1 + r_k} U_{k+1}^{-}(\mathcal{z})
        \end{align}
    \end{subequations}

    \section{Характеристики}
    \subsection{Избор}
    \subsection{Извличане}
        Първо се изчита wav файла, като данни се запазват в масив от float числа.
        Базирайки се на идеята, че вокалния тракт е статичен за много къс период от време,
        накъсваме масива с данните на отделни застъпващи се фреймове, в рамките на които сигналът е статичен ("представяме си, че е статичен"). За да получим добра
        добра честотна резолюция, трябва да се включат голям брой samples от файла, но колкото по-голяма е дължината
        на фрейма, толкова по-голям е шансът да включим данни за различни конфигурации на глотиса.
        За да се постигне някакъв trade-off между двете, обикновено стойностите, които се избират, са 
        25 милисекунди за дължина на фрейм и 10 милисекунди за разстояние между два последователни фрейма.[Paul]
        
        Тъй като алгоритъмът за извличане на mfcc коефициенти, изисква броя на самплите да е степен на 2,
        допълваме последните фреймове с 0, ако това е нужно, тъй като това не влияе на точността. [мжое би онази статия за fourier]

    \section{Класификация}    
    \section{Резултати}

\chapter{Грубо в мозъка}
    \section{Характеристики}
        \subsection{Избор}
        \subsection{Извличане}
    \section{Класификация}    
    \section{Резултати}
\chapter{Двойната звезда}
    \section{Резултати}
\chapter{Големият портрет}


\end{document}